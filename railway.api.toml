# Railway Deployment Configuration - API Service (Explicit)
# This configuration is specifically for the FastAPI service
#
# To use this configuration in Railway Dashboard:
# 1. Go to Service Settings → Build
# 2. Set "Config File Path" to: railway.api.toml

[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile.api"

# Optional: Watch patterns to trigger deployments only when specific files change
# Uncomment to enable conditional deployments (saves build time and costs)
watchPatterns = ["api/**", "requirements-fastapi.txt", "Dockerfile.api"]

# ═══════════════════════════════════════════════════════════
# Deploy Configuration
# ═══════════════════════════════════════════════════════════
[deploy]
# IMPORTANT: Use $PORT environment variable (Railway assigns this dynamically)
# DO NOT hardcode port 8000 - Railway will assign a different port
# Use sh -c to ensure environment variable expansion
startCommand = "sh -c 'uvicorn api.main:app --host 0.0.0.0 --port ${PORT:-8000}'"

# Healthcheck configuration
healthcheckPath = "/health"
healthcheckTimeout = 100

# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Graceful shutdown configuration
# Time between SIGTERM and SIGKILL (default: 30s)
drainingSeconds = 30

# Deployment overlap for zero-downtime deployments
# Previous deployment stays alive for this duration during new deployment
overlapSeconds = 0
